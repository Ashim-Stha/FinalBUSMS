<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="fonts/icomoon/style.css">

    <link rel="stylesheet" href="css/owl.carousel.min.css">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="css/bootstrap.min.css">
    
    <!-- Style -->
    <link rel="stylesheet" href="css/admin database.css">

    <title>Database</title>
  </head>
  <body>
  

    <div class="content">
    
      <div class="container">
        <h2 class="mb-5">Employee Database</h2>
        
  
        <div class="table-responsive custom-table-responsive">
  
          <table class="table custom-table">
            <thead>
              <tr>  
  
                <th scope="col">
                  <!-- <label class="control control--checkbox">
                    <input type="checkbox"  class="js-check-all"/>
                    <div class="control__indicator"></div>
                  </label> -->
                </th>
                
                <th scope="col">ID</th>
                <th scope="col">Name</th>
                <!-- <th scope="col">Job Title</th> -->
                <th scope="col">Contact</th>
                <th scope="col">Address</th>
                <th scope="col">Job Title</th>
                <th scope="col">Verification Status</th>
                <!-- <th scope="col">Bus ID</th> -->
  
              </tr>
            </thead>
            <tbody id="employee">
              <tr scope="row">
                <th scope="row">
                  <!-- <label class="control control--checkbox">
                    <input type="checkbox"/>
                    <div class="control__indicator"></div>
                  </label> -->
                </th>
                <td>
                  1392
                </td>
                <td>James Yates</td>
                <!-- <td>
                  Web Designer -->
                  <!-- <small class="d-block">Far far away, behind the word mountains</small> -->
                <!-- </td> -->
                <td>+63 983 0962 971</td>
                <td><address> Pokhara</address></td>
                <!-- <td>
                  139
                </td> -->
              </tr>
              <tr class="spacer"><td colspan="100"></td></tr>
              
                <th scope="row"><td>4616</td>
                  <!-- <label class="control control--checkbox">
                    <input type="checkbox" checked="" />
                    <div class="control__indicator"></div>
                  </label> -->
                </th>
                
                
                <td>Matthew Wasil</td>
                <!-- <td>
                  Graphic Designer -->
                  <!-- <small class="d-block">Far far away, behind the word mountains</small> -->
                <!-- </td> -->
                <td>+02 020 3994 929</td>
                <td><address> College</address></td>
                <!-- <td>
                  132
                </td> -->
              </tr>
              <tr class="spacer"><td colspan="100"></td></tr>
              <tr>
                <th scope="row">
                  <!-- <label class="control control--checkbox">
                    <input type="checkbox"/>
                    <div class="control__indicator"></div>
                  </label> -->
                </th>
                
                <td>9841</td>
                <td>Sampson Murphy</td>
                <!-- <td>
                  Mobile Dev -->
                  <!-- <small class="d-block">Far far away, behind the word mountains</small> -->
                <!-- </td> -->
                <td>+01 352 1125 0192</td>
                <td><address> High</address></td>
                <!-- <td>
                  192
                </td> -->
              </tr>
              <tr class="spacer"><td colspan="100"></td></tr>
              <tr>
                <th scope="row">
                  <!-- <label class="control control--checkbox">
                    <input type="checkbox"/>
                    <div class="control__indicator"></div>
                  </label> -->
                </th>
                
                <td>9548</td>
                <td>Gaspar Semenov</td>
                <!-- <td>
                  Illustrator -->
                  <!-- <small class="d-block">Far far away, behind the word mountains</small> -->
                <!-- </td> -->
                <td>+92 020 3994 929</td>
                <td><address>KTM</address></td>
                <!-- <td>
                  392
                </td> -->
              </tr>
              
            </tbody>
          </table>
          <p class="bton">
      <label class="btn"><button><p class="Edit"><a href="signup.html" style="color: white;">Add</a></p></button></label>
      <label class="btn"><button><p class="Edit"><a href="ModifyEmployee.html" style="color: white;">Modify</a></p></button></label>
      <label class="btn"><button id=deleteEmp><p class="Edit">Delete</p></button></label>
      </p>
        </div>
  
  
      </div>
  
    </div>
    
 <!-- bus database  -->
<div class="content">
    
  <div class="container">
    <h2 class="mb-5">Bus Database</h2>
    

    <div class="table-responsive custom-table-responsive">

      <table class="table custom-table">
        <thead>
          <tr>  

            <th scope="col">
              <!-- <label class="control control--checkbox">
                <input type="checkbox"  class="js-check-all"/>
                <div class="control__indicator"></div>
              </label> -->
            </th>
            
            <!-- <th scope="col">ID</th> -->
            <th scope="col">Bus ID
            </th>
            <th scope="col">Registration Number</th>
            <th scope="col">Type</th>
            <th scope="col">Size</th>
            <!-- <th scope="col">Route</th> -->
          </tr>
        </thead>
        <tbody id="bus">
          <tr scope="row">
            <th scope="row">
              <!-- <label class="control control--checkbox">
                <input type="checkbox"/>
                <div class="control__indicator"></div>
              </label> -->
            </th>
            <!-- <td>
              1
            </td> -->
            <td>1392</td>
            <td>
              coach
              <!-- <small class="d-block">Far far away, behind the word mountains</small> -->
            </td>
            <td> 91</td>
            <!-- <td>60</td> -->
          </tr>
          <tr class="spacer"><td colspan="100"></td></tr>
          
            <th scope="row">
              
              <!-- <label class="control control--checkbox">
                <input type="checkbox" checked="" />
                <div class="control__indicator"></div>
              </label> -->
            </th>
            
<!--               
            <td><a href="#">Busname 2</a></td> -->
            <td>
              4616
              <!-- <small class="d-block">Far far away, behind the word mountains</small> -->
            </td>
            <td>4wd</td>
            <td>34</td>
          </tr>
          <tr class="spacer"><td colspan="100"></td></tr>
          <tr>
            <th scope="row">
              <!-- <label class="control control--checkbox">
                <input type="checkbox"/>
                <div class="control__indicator"></div>
              </label> -->
            </th>
            
            <!-- <td>1</td> -->
            <!-- <td><a href="#">Bus 3</a></td> -->
            <td>
              102
              <!-- <small class="d-block">Far far away, behind the word mountains</small> -->
            </td>
            <td> deluxe</td>
            <td>80</td>
          </tr>
          <tr class="spacer"><td colspan="100"></td></tr>
          <tr>
            <th scope="row">
              <!-- <label class="control control--checkbox">
                <input type="checkbox"/>
                <div class="control__indicator"></div>
              </label> -->
            </th>
            
            <!-- <td>98</td> -->
            <!-- <td><a href="#">Bus 4</a></td> -->
            <td>
              1040
              <!-- <small class="d-block">Far far away, behind the word mountains</small> -->
            </td>
            <td>super comfy</td>
            <td>100</td>
          </tr>
          
        </tbody>
      </table>
      <p class="bton">
          <label class="btn"><button><p class="Edit"><a href="Bus registration.html" style="color: white;">Add</a></p></button></label>
          <label class="btn"><button><p class="Edit"><a href="BusModify.html" style="color: white;">Modify</a></p></button></label>
          <label class="btn"><button id="deleteBus"><p class="Edit">Delete</p></button></label>
          </p>
    </div>


  </div>

</div> 


<div class="content">
    
  <div class="container">
    <h2 class="mb-5">Bus Database</h2>
    

    <div class="table-responsive custom-table-responsive">

      <table class="table custom-table">
        <thead>
          <tr>  

            <th scope="col">
              <!-- <label class="control control--checkbox">
                <input type="checkbox"  class="js-check-all"/>
                <div class="control__indicator"></div>
              </label> -->
            </th>
            
            
            <th scope="col">Assignment ID</th>
            <th scope="col">Employee ID</th>
            <th scope="col">Employee Name</th>
            <th scope="col">Bus ID</th>
            <th scope="col">Stage ID</th>
            <th scope="col">Route</th>
            <th scope="col">Garage</th>
            
          </tr>
        </thead>
        <tbody id="assignments">
          <tr scope="row">
            <th scope="row">
              <!-- <label class="control control--checkbox">
                <input type="checkbox"/>
                <div class="control__indicator"></div>
              </label> -->
            </th>
            <td>
              1
            </td>
            <td>1392</td>
            <td>
              Ankit
              <!-- <small class="d-block">Far far away, behind the word mountains</small> -->
            </td>
            <td> 91</td>
            <td>60</td>
            <td><address>PKR-KTM</address></td>
            <td>Yes</td>
          </tr>
          <tr class="spacer"><td colspan="100"></td></tr>
          
            <th scope="row">
              
              <!-- <label class="control control--checkbox">
                <input type="checkbox" checked="" />
                <div class="control__indicator"></div>
              </label> -->
            </th>
            
            
            <td>1</td>
            <td>
              4616
              <!-- <small class="d-block">Far far away, behind the word mountains</small> -->
            </td>
            <td>Ash</td>
            <td>34</td>
            <td>56</td>
            <td><address>PKR-KTM</address></td>
            <td>yes</td>
          </tr>
          <tr class="spacer"><td colspan="100"></td></tr>
          <tr>
            <th scope="row">
              <!-- <label class="control control--checkbox">
                <input type="checkbox"/>
                <div class="control__indicator"></div>
              </label> -->
            </th>
            
            <td>1</td>
            <!-- <td><a href="#">Bus 3</a></td> -->
            <td>
              102
              <!-- <small class="d-block">Far far away, behind the word mountains</small> -->
            </td>
            <td> Ashim</td>
            <td>80</td>
            <td>0</td>
            <td><address>BUTWAL</address></td>
            <td>no</td>
          </tr>
          <tr class="spacer"><td colspan="100"></td></tr>
          <tr>
            <th scope="row">
              <!-- <label class="control control--checkbox">
                <input type="checkbox"/>
                <div class="control__indicator"></div>
              </label> -->
            </th>
            
            <td>1</td>
            <!-- <td><a href="#">Bus 4</a></td> -->
            <td>
              1040
              <!-- <small class="d-block">Far far away, behind the word mountains</small> -->
            </td>
            <td>Nishanta</td>
            <td>100</td>
            <td>100</td>
            <td>Dhading</td>
            <td>no</td>
          </tr>
          
        </tbody>
      </table>
      <p class="bton">
        <label class="btn"><button><p class="Edit"><a href="AssignmentAdd.html" style="color: white;">Add</a></p></button></label>
        <label class="btn"><button><p class="Edit"><a href="AssignmentModify.html" style="color: white;">Modify</a></p></button></label>
        <label class="btn"><button><p class="Edit">Delete</p></button></label>
        </p>
    </div>


  </div>

</div>
    

    <script src="js/jquery-3.3.1.min.js"></script>
    <!-- <script src="js/popper.min.js"></script>
    <script src="js/bootstrap.min.js"></script> -->
    <script src="js/main.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", async function () {
        const tableEmployee = document.querySelector("#employee");

        const getUser = async () => {
          try {
            const response = await fetch(
              "http://localhost:3000/api/users/employees",
              {
                method: "GET",
                headers: {
                  "Content-Type": "application/json",
                },
              }
            );

            const jsonRes = await response.json();
            const employees = jsonRes.data;

            // Clear existing table rows
            tableEmployee.innerHTML = "";

            // Populate table rows with data
            employees.forEach((employee) => {
              const row = document.createElement("tr");
              row.innerHTML = `
          <td>
            <label class="control control--checkbox">
              <input type="checkbox" data-employee-id="${employee.employee_id}" />
              <div class="control__indicator"></div>
            </label>
          </td>
          <td>${employee.employee_id}</td>
          <td>${employee.employee_name}</td>
          <td>${employee.telephone_number}</td>
          <td>${employee.address}</td>
          <td>${employee.job_title}</td>
          <td>${employee.verification_status}</td>
        `;

              tableEmployee.appendChild(row);
            });
          } catch (err) {
            console.error(err);
          }
        };

        // setInterval(() => {
        //   getUser();
        // }, 1000);

        getUser();

       const tableBus=document.querySelector('#bus');
        const getBus=async ()=>{

          try{
            const response = await fetch(
              "http://localhost:3000/api/users/buses",
              {
                method: "GET",
                headers: {
                  "Content-Type": "application/json",
                },
              }
            );

            const jsonRes = await response.json();
            const buses = jsonRes.data;

           tableBus.innerHTML="";


           buses.forEach((bus)=>{
            const row=document.createElement('tr')
           row.innerHTML=`  <td>
            <label class="control control--checkbox">
              <input type="checkbox" data-employee-id="${bus.bus_id}" />
              <div class="control__indicator"></div>
            </label>
          </td>
          
          <td>${bus.bus_id}</td>
          <td>${bus.bus_registration_number}</td>
          <td>${bus.bus_type}</td>
          <td>${bus.bus_size}</td>
         
       
           `
      tableBus.appendChild(row)

           })
           
          }catch(err){
            console.log(err);
          }
        }

        getBus();

        const tableAssignments=document.querySelector('#assignments');
        const getAssignments=async ()=>{

          try{
            const response = await fetch(
              "http://localhost:3000/api/users/busassignments",
              {
                method: "GET",
                headers: {
                  "Content-Type": "application/json",
                },
              }
            );

            const jsonRes = await response.json();
            const assigned = jsonRes.data;

           tableAssignments.innerHTML="";


           assigned.forEach((assign)=>{
            const row=document.createElement('tr')
           row.innerHTML=`  <td>
            <label class="control control--checkbox">
              <input type="checkbox" data-employee-id="${bus.bus_id}" />
              <div class="control__indicator"></div>
            </label>
          </td>
          
          <td>${assign.assignment_id}</td>
          <td>${assign.employee_id}</td>
          <td>${assign.employee_name}</td>
          <td>${assign.bus_id}</td>
          <td>${assign.stage_id}</td>
          <td>${assign.route_name}</td>
          <td>${assign.garage}</td>
         
       
           `
      tableAssignments.appendChild(row)

           })
           
          }catch(err){
            console.log(err);
          }
        }

        getAssignments();
        // const verify = document.getElementById("verify");

        // verify.addEventListener("click", function () {
        //   const selectedCheckboxes = document.querySelectorAll(
        //     'input[type="checkbox"]:checked'
        //   );

        //   const employeeIds = Array.from(selectedCheckboxes).map((checkbox) =>
        //     checkbox.getAttribute("data-employee-id")
        //   );

        //   console.log(employeeIds);

        //   employeeIds.forEach(function (id, index) {
        //     const verifyApi = async (id) => {
        //       try {
        //         const response = await fetch(
        //           `http://localhost:3000/api/users/verify/${id}`,
        //           {
        //             method: "PATCH",
        //             headers: {
        //               "Content-Type": "application/json",
        //             },
        //           }
        //         );

        //         const jsonRes = await response.json();
        //         // console.log(jsonRes.success);

        //         getUser();
        //       } catch (err) {
        //         if (err) return console.log(err);
        //       }
        //     };

        //     verifyApi(id);
        //   });
        // });

        const deleteEmp = document.getElementById("deleteEmp");

        deleteEmp.addEventListener("click", function () {
          const selectedCheckboxes = document.querySelectorAll(
            'input[type="checkbox"]:checked'
          );

          const employeeIds = Array.from(selectedCheckboxes).map((checkbox) =>
            checkbox.getAttribute("data-employee-id")
          );

          employeeIds.forEach(function (id, index) {
            console.log(id);
            const deleteEmployee = async (id) => {
              try {
                const response = await fetch(
                  `http://localhost:3000/api/users/deleteEmp/${id}`,
                  {
                    method: "DELETE",
                    headers: {
                      "Content-Type": "application/json",
                    },
                  }
                );

                const jsonRes = await response.json();
                // console.log(jsonRes.success);

                getUser();
              } catch (err) {
                if (err) return console.log(err);
              }
            };

            deleteEmployee(id);
          });
        });

        const deleteBus = document.getElementById("deleteBus");

        deleteBus.addEventListener("click", function () {
          const selectedCheckboxes = document.querySelectorAll(
            'input[type="checkbox"]:checked'
          );

          const employeeIds = Array.from(selectedCheckboxes).map((checkbox) =>
            checkbox.getAttribute("data-employee-id")
          );

          employeeIds.forEach(function (id, index) {
            console.log(id);
            const deleteBuses = async (id) => {
              try {
                const response = await fetch(
                  `http://localhost:3000/api/users/deleteBus/${id}`,
                  {
                    method: "DELETE",
                    headers: {
                      "Content-Type": "application/json",
                    },
                  }
                );

                const jsonRes = await response.json();
                // console.log(jsonRes.success);

                getBus();
              } catch (err) {
                if (err) return console.log(err);
              }
            };

            deleteBuses(id);
          });
        });
      });
    </script>
  </body>
</html>